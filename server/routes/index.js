//======================================================================================
//Import required modules ==============================================================
//======================================================================================
let express = require('express');
let router = express.Router();

//======================================================================================
// GET home page. ======================================================================
//======================================================================================
router.get('/',(req, res, next) => {
  res.render('index', { title: 'Express from server folder' });
});

//======================================================================================
// GET login page. =====================================================================
//======================================================================================
router.get('/login', (req, res, next) => {
  res.render('login', {
    title:"Login Page",
    message: req.flash('loginMessage')
  });
});


//======================================================================================
// POST login page. ====================================================================
//======================================================================================
router.post('/signup', passport.authenticate('local-signup',{
//Success go to Profile Page, Fail go to Signup Page====================================
    successRedirect :'/profile',
    failureRedirect :'/signup',
    failureFlash : true
}));



//======================================================================================
// GET Signup page. ====================================================================
//======================================================================================
router.get('/signup', (req, res) => {
   res.render('signup',
       {
       title:"Signup Page",
       message: req.flash('signupMessage')
       }
   )
});

//======================================================================================
// POST Signup =========================================================================
//======================================================================================

router.post('/signup', passport.authenticate('local-signup', {
// Go to Profile page if success =======================================================
    successRedirect : '/profile',
    failureRedirect : '/signup',
    failureFlash: true
}));

//======================================================================================
// GET profile page. ===================================================================
//======================================================================================
router.get('/profile', (req, res, next) => {
   res.render('profile',
       {
       title:"Profile Page",
       user: req.user,
       avatar: gravatar.url(rea.user.email,{
           s:'100',
           r:'x',
           d:'retro'
       },
       true)
       });
});

//======================================================================================
// Check if user is logged in ==========================================================
//======================================================================================
isLoggedIn = (req, res, next) => {
    if (req.isAuthenticated())
        return next();
    res.redirect('/login');
};

//======================================================================================
// Get Logout Page =====================================================================
//======================================================================================
router.get('/logout', (req, res) => {
    req.logout();
    res.redirect('/');
});

module.exports = router;

